# Kook-OnlineUser-Bot
A Online-User Checking Bot for KOOK (khl.py)

一个可以显示当前KOOK服务器`在线/总人数`的bot

## 1.Command 命令
目前在线/总人数小助手支持的指令如下

### 1.1 频道在线人数/总人数监看

| 命令      | 功能                                       |
| ------------- | ------------------------------------------ |
| `/alive`           | 看看bot是否在线 |
| `/svck` | 查看当前服务器的在线/总人数        |
| `/adsv1 '前缀' '后缀'`| 在当前频道设置本服务器的在线人数更新 |
| `/adsv2 频道id '前缀' '后缀'`| 在指定频道设置在线人数更新（推荐设置为频道分区） |
| `/tdsv` | 取消本服务器的在线人数监看 |

频道名字的默认格式为`频道在线 10/100`。其中`频道在线 `为前缀，默认后缀为空。可以手动指定前缀和后缀，来适应你的频道的命名风格。记得加**英文的引号**来保证前缀/后缀的完整性！

在线人数监看设定为**20分钟**更新一次，使用示例如下：
```
/adsv2 111111111111 "频道在线 | " " 测试ing"
```
注意，第二个参数 **频道id** 不是频道名字！

> 频道id获取办法：`kook设置-高级设置-打开开发者模式`；右键用户头像即可复制用户id，右键频道/分组即可复制id，角色id需要进入服务器管理面板的角色页面中右键复制

### 1.2 昨日新增人数追踪

| 命令      | 功能                                       |
| ------------- | ------------------------------------------ |
| `/adld`           | 在当前服务器开启昨日新增用户追踪器 |
| `/adld 1` | 会设置定时任务，每日`00:00`向当前频道发送昨日新增用户的数量       |
| `/adld 2` | 会向当前频道发送消息的同时，更新频道名称 |
| `/ldck`| 手动查看本服务器的昨日新增用户数量 |
| `/tdld` | 取消本服务器的昨日新增人数追踪 |


## 2.Requerments 依赖项

保证你的Python版本高于3.7，安装下面的包
```
pip install -r reqiurements.txt
```

框架基于[khl.py](https://github.com/TWT233/khl.py/tree/main/example)，使用`aiohttp`来调用kook官方的api，对频道进行编辑。

> aiohttp已在khl.py中包含，无需手动下载

关于code里面的makefile，这是用于linux下快速启动bot后台运行的。如果你想在自己的linux服务器使用，请把里面的`py3`改成你自己云服务器上的python（就是用来命令行运行python程序的哪一个，如`python3`）

## 3.Config 配置

### 3.1 bot token
在 `code/config`路径中添加`config.json`，并在里面填入以下内容来初始化你的Bot

```json
{
    "token": "kook-bot websocket token",
    "verify_token": "",
    "encrypt_key": ""
}
```

### 3.2 log

在 `code/log` 路径中添加两个文件，`server.json`&`yesterday.json`

```
server.json    初始化为 {}
yesterday.json 初始化为 []
```

其余无须配置，bot会自动创建用于记录的键值对并保存到文件中；

>昨日新增用户查看的功能是我刚学习写bot的时候写的，当初还不知道如何使用dict，所以用的是list。好在并没有bug，可以放心使用。后续会找时间对此功能重构。

## Hit a Star!

如果这个项目对你有帮助，还请点个✨支持一下！